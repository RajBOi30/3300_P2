<html>

<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
  <svg id="map" height="600" width="600" style="background:rgb(253, 253, 217)"></svg>
  <script>
    function MenuItem(name, calories, ingredients, category) {
      this.name = name;
      this.calories = calories;
      this.ingredients = ingredients;
      this.category = category;
    }

    let menu = [];
    svg = d3.select("svg#map");
    width = svg.attr("width");
    height = svg.attr("height");

    d3.csv("ingredients.csv").then(ingredientsData => {
      d3.csv("nutrition.csv").then(nutritionData => {
        ingredientsData.forEach(ingredient => {
          let item = new MenuItem(ingredient.Item, 0, ingredient.Ingredients);
          let nutritionInfo = nutritionData.find(nutrition => nutrition.Item === ingredient.Item);
          if (nutritionInfo) {
            item.calories = nutritionInfo.Calories;
            item.category = nutritionInfo.Category;
          }
          menu.push(item);
        });
        const caloriesExtent = d3.extent(menu, d => d.calories);
        const sizeScale = d3.scaleLinear()
          .domain(caloriesExtent)
          .range([10, 20]);

        // Set random initial positions for circles
        menu.forEach(d => {
          d.x = Math.random() * width;
          d.y = Math.random() * height;
        });

        let circles = svg.selectAll("circle").data(menu)
          .join("circle")
          .attr("r", d => sizeScale(d.calories))
          .attr("fill", "dodgerblue");

        let simulation = d3.forceSimulation(menu)
          .force("charge", d3.forceManyBody().strength(5))
          .force("collision", d3.forceCollide().radius(d => sizeScale(d.calories) + 2))
          .on("tick", update);

        function update() {
          circles.attr("cx", d => d.x)
            .attr("cy", d => d.y);
        }
      });
    });

  </script>
</body>

</html>