<html>

<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
  <svg id="map" height="4000" width="6000" style="background:yellow"></svg>
  <script>

    //We created an object that will hold the relevant information for each item. 
    function MenuItem(name, calories, ingredients, category) {
      this.name = name;
      this.calories = calories;
      this.ingredients = ingredients;
      this.category = category;
    }

    let menu = [];

    let items = [];
    let calories = [];
    var svg = d3.select("body")
          .append("svg")
          .attr("width", 6000)
          .attr("height", 4000);
    d3.csv("ingredients.csv").then(data => {
      data.forEach(d => {
        menu.push(new MenuItem(d.Item, 0, d.Ingredients));
      });
    });
    d3.csv("nutrition.csv").then(data => {
      //const extent = d3.extent(data, d => d.log_attempt);

      //const scale = d3.scaleSequential(d3.interpolateViridis).domain(extent);

      //extract 'calories' values
      const calories = data.map(d => parseFloat(d.Calories));

      //scale for circle sizes
      var sizeScale = d3.scaleLinear()
          .domain([d3.min(calories), d3.max(calories)])
          .range([10, 70]);  

      console.log(calories);

      function checkCollision(circles, newCircle) {
          for (let i = 0; i < circles.length; i++) {
              const existingCircle = circles[i];
              const distance = Math.sqrt(
                  Math.pow(newCircle.cx - existingCircle.cx, 2) +
                  Math.pow(newCircle.cy - existingCircle.cy, 2)
              );
              if (distance < newCircle.r + existingCircle.r) {
                  return true;  //if collision detected
              }
          }
          return false;  
      }

      //create a force simulation
      var simulation = d3.forceSimulation(data)
          .force("x", d3.forceX().strength(0.1).x(d => Math.random() * 500))  // Random x positions
          .force("y", d3.forceY().strength(0.1).y(d => Math.random() * 500))  // Random y positions
          .force("collide", d3.forceCollide().radius(function (d) {
              return sizeScale(parseFloat(d.Calories));
      }));


      //create circles
      var circles = svg.selectAll("circle")
          .data(data)
          .enter().append("circle")
          .attr("r", function (d) { return sizeScale(parseFloat(d.Calories)); })
          .attr("fill", "steelblue");

      //update positions in each tick of the simulation
      simulation.on("tick", function () {
          circles.attr("cx", function (d) { return d.x; })
              .attr("cy", function (d) { return d.y; });
      });

      data.forEach(d => {
        if (menu.find(i => i.name === d.Item)) {
          menu.find(i => i.name === d.Item).calories = d.Calories;
          menu.find(i => i.name === d.Item).category = d.Category;
        }
      });
    });

    // Strawberry Banana Smoothie (Medium)
    // menu.find(i => i.name === d.Item).category = d.Category;


    // console.log(items);
    // console.log(calories.length); 
  </script>
</body>

</html>